# FPGA ê¸°ë°˜ ë„ì–´ë½ í”„ë¡œì íŠ¸ íšŒê³  ë° ê°œì„ ì‚¬í•­

## ğŸ“Œ í”„ë¡œì íŠ¸ ê°œìš”

- **í”„ë¡œì íŠ¸ëª…**: RISC-V ê¸°ë°˜ FPGA ë„ì–´ë½ ì‹œìŠ¤í…œ
- **ê°œë°œ ê¸°ê°„**: 2024.09.29 ~ 2024.11.28 (9ì£¼)
- **í”Œë«í¼**: Xilinx ZedBoard (Zynq-7000 SoC FPGA)
- **í•µì‹¬ ê¸°ëŠ¥**: RFID ì¹´ë“œ + í‚¤íŒ¨ë“œ ë¹„ë°€ë²ˆí˜¸ 2ë‹¨ê³„ ì¸ì¦

---

## ğŸ˜” í”„ë¡œì íŠ¸ ì•„ì‰¬ìš´ ì 

### 1. **SPI íŒì›¨ì–´ ë¯¸ì™„ì„±**

#### í˜„ìƒ

- **MFRC522 RFID Readerì™€ì˜ SPI í†µì‹  ë¶ˆì•ˆì •**
  - MISO(Master In Slave Out) ì‹ í˜¸ê°€ í•­ìƒ `0x00`ìœ¼ë¡œ ì½í˜
  - RFID ì¹´ë“œ ë²„ì „ ë ˆì§€ìŠ¤í„° ì½ê¸° ì‹¤íŒ¨ (ê¸°ëŒ€ê°’: `0x91` ë˜ëŠ” `0x92`)
  - í•˜ë“œì›¨ì–´ Loopback í…ŒìŠ¤íŠ¸ì—ì„œë„ ë™ì¼í•œ ë¬¸ì œ ë°œìƒ

#### ì›ì¸ ë¶„ì„

1. **í•˜ë“œì›¨ì–´ ì´ìŠˆ**

   - ZedBoard Pmod JC í•€ê³¼ MFRC522 HAT ê°„ ë°°ì„  ë¬¸ì œ ê°€ëŠ¥ì„±
   - IOSTANDARD ì„¤ì • ë¶ˆì¼ì¹˜ (LVCMOS33 vs LVCMOS25)
   - Tri-state ë²„í¼ íƒ€ì´ë° ë¬¸ì œ

2. **íŒì›¨ì–´ ë ˆë²¨ ì´ìŠˆ**

   - SPI AXI ì¸í„°í˜ì´ìŠ¤ ë ˆì§€ìŠ¤í„° ë§¤í•‘ ì˜¤ë¥˜
   - MISO ë°ì´í„° ìƒ˜í”Œë§ íƒ€ì´ë° ë¬¸ì œ
   - SPI í´ëŸ­ ê·¹ì„±(CPOL) ë° ìœ„ìƒ(CPHA) ì„¤ì • ë¶ˆì¼ì¹˜

3. **RTL ì„¤ê³„ ì´ìŠˆ**
   - AXI Handshake ì‹ í˜¸ ë™ê¸°í™” ë¬¸ì œ
   - SPI Master FSM ìƒíƒœ ì „ì´ ì˜¤ë¥˜
   - MISO ì‹ í˜¸ì˜ Tri-state ì œì–´ ë¡œì§ ë¯¸í¡

#### ë””ë²„ê¹… ì‹œë„ ë‚´ì—­

- âœ… Vivado XDC íŒŒì¼ í•€ ë§¤í•‘ ê²€ì¦
- âœ… SW0 ê¸°ë°˜ í•˜ë“œì›¨ì–´ Loopback í…ŒìŠ¤íŠ¸ êµ¬í˜„
- âœ… SPI í´ëŸ­ ë¶„ì£¼ë¹„ ì¡°ì • (100MHz â†’ 12.5MHz)
- âœ… AXI-Lite ë²„ìŠ¤ íŠ¸ëœì­ì…˜ íŒŒí˜• ë¶„ì„
- âŒ MISO ì½ê¸° ë¬¸ì œ ê·¼ë³¸ ì›ì¸ ë¯¸í•´ê²°

---

### 2. **í†µí•© í…ŒìŠ¤íŠ¸ ë¶€ì¡±**

- **ê°œë³„ ëª¨ë“ˆ ê²€ì¦ì€ ì™„ë£Œí–ˆìœ¼ë‚˜ ì „ì²´ ì‹œìŠ¤í…œ í†µí•© í…ŒìŠ¤íŠ¸ ë¯¸í¡**
  - GPIO, UART, IÂ²CëŠ” ê°œë³„ì ìœ¼ë¡œ ì •ìƒ ë™ì‘ í™•ì¸
  - RFID + í‚¤íŒ¨ë“œ + EEPROM í†µí•© ì‹œë‚˜ë¦¬ì˜¤ ì‹¤ì œ ê²€ì¦ ë¶€ì¡±
  - Edge Case ì²˜ë¦¬ ë¯¸ë¹„ (ì˜ˆ: EEPROM ì½ê¸° ì¤‘ ì¸í„°ëŸ½íŠ¸ ë°œìƒ)

### 3. **ì‹œê°„ ê´€ë¦¬ ì‹¤íŒ¨**

- **í›„ë°˜ë¶€ ì¼ì • ì••ë°•ìœ¼ë¡œ ì¸í•œ í’ˆì§ˆ ì €í•˜**
  - SPI ê¸°ëŠ¥ì„ ì´ˆê¸° ê³„íšë³´ë‹¤ ëŠ¦ê²Œ ì°©ìˆ˜
  - ë””ë²„ê¹… ì‹œê°„ ê³¼ì†Œí‰ê°€ (ì˜ˆìƒ 1ì£¼ â†’ ì‹¤ì œ 3ì£¼ ì†Œìš”)
  - ìµœì¢… 2ì£¼ê°„ SPI ë¬¸ì œ í•´ê²°ì— ì§‘ì¤‘í•˜ëŠë¼ ë¬¸ì„œí™” ë¶€ì¡±

### 4. **í•˜ë“œì›¨ì–´ ê²€ì¦ í™˜ê²½ ë¶€ì¡±**

- **Oscilloscope/Logic Analyzer ë¯¸ë³´ìœ **
  - ì‹¤ì œ SPI ì‹ í˜¸ íŒŒí˜• í™•ì¸ ë¶ˆê°€
  - í•˜ë“œì›¨ì–´ ë ˆë²¨ ë””ë²„ê¹… ì œí•œ
  - ì¶”ì¸¡ì— ì˜ì¡´í•œ ë¬¸ì œ í•´ê²° ì‹œë„

---

## ğŸ“š êµí›ˆ ë° ê¹¨ë‹¬ì€ ì 

### 1. **"í•˜ë‚˜ì”© ìŒ“ì•„ì˜¬ë ¤ì•¼ í•œë‹¤"ì˜ ì¤‘ìš”ì„±**

> **"ë³µì¡í•œ ì‹œìŠ¤í…œì€ ê²€ì¦ëœ ì‘ì€ ë¸”ë¡ì˜ ì¡°í•©ì´ë‹¤"**

#### êµ¬ì²´ì  êµí›ˆ

- **Bottom-Up ì ‘ê·¼ì˜ ì¤‘ìš”ì„±**

  - ê° Peripheralì„ ì™„ì „íˆ ê²€ì¦í•œ í›„ í†µí•©í•´ì•¼ í•¨
  - GPIO â†’ UART â†’ IÂ²C â†’ SPI ìˆœì„œë¡œ ë‹¨ê³„ë³„ ê²€ì¦ í•„ìš”
  - ì´ì „ ë‹¨ê³„ê°€ ë¶ˆì•ˆì •í•œ ìƒíƒœì—ì„œ ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰ ê¸ˆì§€

- **ì‘ì€ ì„±ê³µì˜ ì¶•ì **
  ```
  GPIO ë‹¨ë… í…ŒìŠ¤íŠ¸ ì„±ê³µ
    â†’ GPIO + UART í†µí•© ì„±ê³µ
      â†’ GPIO + UART + IÂ²C í†µí•© ì„±ê³µ
        â†’ ì „ì²´ ì‹œìŠ¤í…œ í†µí•© (ì•ˆì •ì„± í™•ë³´)
  ```

#### ì‹¤ì œ ì ìš© ì‚¬ë¡€

- **IÂ²C EEPROM ê°œë°œ ê³¼ì •**

  1. âœ… IÂ²C Master RTL ë‹¨ë… ì‹œë®¬ë ˆì´ì…˜
  2. âœ… Testbenchë¡œ Write/Read ê²€ì¦
  3. âœ… FPGA í¬íŒ… í›„ ì‹¤ì œ EEPROM í†µì‹  í™•ì¸
  4. âœ… Firmware API ê°œë°œ ë° í†µí•©
  5. âœ… **ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œ** (ì˜ˆì • ê¸°ê°„ ë‚´)

- **SPI ê°œë°œ ì‹¤íŒ¨ ì›ì¸**
  1. âŒ RTL ì‹œë®¬ë ˆì´ì…˜ ë¶ˆì¶©ë¶„
  2. âŒ AXI ì¸í„°í˜ì´ìŠ¤ ê²€ì¦ ìƒëµ
  3. âŒ í•˜ë“œì›¨ì–´ ì—°ê²° ì „ ë‹¨ê³„ë³„ ê²€ì¦ ë¶€ì¡±
  4. âŒ **í†µí•© ë‹¨ê³„ì—ì„œ ë¬¸ì œ ë°œê²¬ â†’ ì‹œê°„ ë¶€ì¡±**

### 2. **ê²€ì¦ ì¸í”„ë¼ì˜ ì¤‘ìš”ì„±**

- **Testbench ìë™í™”**

  - ìˆ˜ë™ í…ŒìŠ¤íŠ¸ëŠ” í•œê³„ê°€ ëª…í™•
  - Regression Test í•„ìˆ˜
  - CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶• í•„ìš”

- **í•˜ë“œì›¨ì–´ ê²€ì¦ ë„êµ¬ í™•ë³´**
  - Logic Analyzer: ì‹¤ì‹œê°„ ë””ì§€í„¸ ì‹ í˜¸ ë¶„ì„
  - Oscilloscope: ì•„ë‚ ë¡œê·¸/íƒ€ì´ë° ì´ìŠˆ ì§„ë‹¨
  - In-Circuit Debugger: FPGA ë‚´ë¶€ ì‹ í˜¸ ëª¨ë‹ˆí„°ë§

### 3. **ë¬¸ì„œí™”ì™€ ë²„ì „ ê´€ë¦¬**

- **ì„¤ê³„ ê²°ì • ì‚¬í•­ ê¸°ë¡**
  - "ì™œ ì´ë ‡ê²Œ ì„¤ê³„í–ˆëŠ”ê°€?"ë¥¼ ë‚¨ê²¨ì•¼ í•¨
  - ë””ë²„ê¹… ì‹œ ê³¼ê±° ê²°ì • ì¶”ì  ê°€ëŠ¥
- **Git í™œìš© ê°•í™”**
  - Feature Branch ì „ëµ
  - ê° Peripheralë³„ ë¸Œëœì¹˜ ë¶„ë¦¬
  - í†µí•© ì „ Code Review í•„ìˆ˜

### 4. **ì¼ì • ë²„í¼ í™•ë³´**

- **íŒŒí‚¨ìŠ¨ì˜ ë²•ì¹™ ê³ ë ¤**
  - "ì¼ì€ ì£¼ì–´ì§„ ì‹œê°„ë§Œí¼ ëŠ˜ì–´ë‚œë‹¤"
  - ë””ë²„ê¹… ì‹œê°„ì€ ì˜ˆìƒì˜ 2~3ë°° í• ë‹¹
  - Critical Path ì‹ë³„ ë° ìš°ì„ ìˆœìœ„ ì¡°ì •

---

## ğŸ”§ ê¸°ìˆ ì  ê°œì„ ì‚¬í•­

### 1. **SPI í†µì‹  ì•ˆì •í™” ë°©ì•ˆ**

#### í•˜ë“œì›¨ì–´ ë ˆë²¨

```verilog
// MISO Tri-state ì œì–´ ê°œì„ 
always @(posedge spi_clk or negedge rst_n) begin
    if (!rst_n) begin
        miso_buf <= 1'b0;
        miso_oe  <= 1'b0;  // Output Enable
    end else begin
        if (spi_state == READ) begin
            miso_oe <= 1'b1;
            miso_buf <= shift_reg[7];  // MSB first
        end else begin
            miso_oe <= 1'b0;  // High-Z
        end
    end
end

assign spi_miso = (miso_oe) ? miso_buf : 1'bz;
```

#### AXI ì¸í„°í˜ì´ìŠ¤ ê°œì„ 

```verilog
// AXI Read Handshake ê°•í™”
typedef enum logic [2:0] {
    AXI_IDLE,
    AXI_ADDR,
    AXI_READ,
    AXI_RESP
} axi_state_t;

always_ff @(posedge clk) begin
    case (axi_state)
        AXI_IDLE: begin
            if (ARVALID) begin
                ARREADY <= 1'b1;
                axi_state <= AXI_ADDR;
            end
        end
        AXI_ADDR: begin
            ARREADY <= 1'b0;
            // SPI Register Read ì‹œì‘
            axi_state <= AXI_READ;
        end
        AXI_READ: begin
            if (spi_ready) begin  // SPI ì „ì†¡ ì™„ë£Œ ëŒ€ê¸°
                RDATA <= spi_rx_data;
                RVALID <= 1'b1;
                axi_state <= AXI_RESP;
            end
        end
        AXI_RESP: begin
            if (RREADY) begin
                RVALID <= 1'b0;
                axi_state <= AXI_IDLE;
            end
        end
    endcase
end
```

#### íŒì›¨ì–´ ë ˆë²¨

```c
// SPI í†µì‹  Retry ë¡œì§ ì¶”ê°€
#define SPI_RETRY_MAX 3

uint8_t spi_read_register_robust(uint8_t reg_addr) {
    uint8_t data;
    int retry = 0;

    while (retry < SPI_RETRY_MAX) {
        data = spi_read_register(reg_addr);

        // Sanity Check
        if (data != 0x00 && data != 0xFF) {
            return data;  // Valid data
        }

        delay_us(1000);  // 1ms ëŒ€ê¸°
        retry++;
    }

    uart_printf("SPI Read Failed after %d retries\n", SPI_RETRY_MAX);
    return 0xFF;  // Error code
}
```

### 2. **í†µí•© ê²€ì¦ ê°•í™”**

#### Co-simulation í™˜ê²½ êµ¬ì¶•

```makefile
# Hardware + Software Co-verification
sim_full: sw hw
	cd $(DIR_HW_SIM); \
	make sim FILE_BIN=$(abspath $(TARGET).bin) \
	         CHECK_UART=1 \
	         CHECK_SPI=1 \
	         CHECK_I2C=1 \
	         VCD=1
```

#### Assertion ê¸°ë°˜ ê²€ì¦

```systemverilog
// SPI Protocol Assertion
property spi_clock_stable;
    @(posedge clk)
    (spi_cs_n == 0) |-> ##1 $stable(spi_clk) throughout (spi_cs_n == 1);
endproperty

assert property (spi_clock_stable)
    else $error("SPI Clock changed during transaction");

// AXI Handshake Assertion
property axi_rvalid_stable;
    @(posedge clk)
    (RVALID && !RREADY) |=> RVALID && $stable(RDATA);
endproperty

assert property (axi_rvalid_stable)
    else $error("RDATA changed while RVALID asserted");
```

### 3. **ëª¨ë“ˆí™” ë° ì¬ì‚¬ìš©ì„± ê°œì„ **

#### Parameterizable SPI Master

```systemverilog
module spi_master #(
    parameter CLK_DIV = 8,           // Clock divider
    parameter DATA_WIDTH = 8,        // 8/16/32 bit
    parameter CPOL = 0,              // Clock polarity
    parameter CPHA = 0,              // Clock phase
    parameter CS_ACTIVE_LOW = 1      // Chip select polarity
) (
    input  logic clk,
    input  logic rst_n,
    // AXI-Lite Slave Interface
    axi_lite_if.slave s_axi,
    // SPI Interface
    output logic spi_clk,
    output logic spi_mosi,
    input  logic spi_miso,
    output logic spi_cs_n
);
```

### 4. **ì „ë ¥ ìµœì í™”**

#### Clock Gating ì ìš©

```verilog
// SPI ë¯¸ì‚¬ìš© ì‹œ í´ëŸ­ ì°¨ë‹¨
logic spi_clk_en;

assign spi_clk_en = (spi_state != IDLE) || spi_req;

BUFGCE spi_clk_gate (
    .I(clk),
    .CE(spi_clk_en),
    .O(spi_clk_gated)
);
```

### 5. **ë””ë²„ê¹… í–¥ìƒ**

#### ILA (Integrated Logic Analyzer) ì¶”ê°€

```tcl
# Vivado ILA ì‚½ì…
create_debug_core u_ila_spi ila
set_property C_DATA_DEPTH 4096 [get_debug_cores u_ila_spi]

# SPI ì‹ í˜¸ ëª¨ë‹ˆí„°ë§
connect_debug_port u_ila_spi/probe0 [get_nets spi_clk]
connect_debug_port u_ila_spi/probe1 [get_nets spi_mosi]
connect_debug_port u_ila_spi/probe2 [get_nets spi_miso]
connect_debug_port u_ila_spi/probe3 [get_nets spi_cs_n]
```

---

## ğŸ¯ í–¥í›„ ê°œì„  ê³„íš

### ë‹¨ê¸° ëª©í‘œ (1ê°œì›”)

1. **SPI í†µì‹  ì™„ì „ í•´ê²°**

   - [ ] Logic Analyzerë¡œ ì‹¤ì œ íŒŒí˜• í™•ì¸
   - [ ] MISO ì‹ í˜¸ ê·¼ë³¸ ì›ì¸ íŒŒì•…
   - [ ] MFRC522 ë²„ì „ ë ˆì§€ìŠ¤í„° ì„±ê³µì  ì½ê¸°
   - [ ] RFID ì¹´ë“œ UID ì•ˆì •ì  íšë“

2. **í†µí•© í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì™„ì„±**
   - [ ] RFID + í‚¤íŒ¨ë“œ + EEPROM ì „ì²´ Flow ê²€ì¦
   - [ ] 100íšŒ ì—°ì† ì¸ì¦ ì„±ê³µë¥  95% ì´ìƒ ë‹¬ì„±

### ì¤‘ê¸° ëª©í‘œ (3ê°œì›”)

1. **CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•**

   - [ ] Jenkins ê¸°ë°˜ ìë™ ë¹Œë“œ
   - [ ] Automated Regression Test
   - [ ] Code Coverage 80% ì´ìƒ

2. **ì¶”ê°€ ê¸°ëŠ¥ êµ¬í˜„**
   - [ ] IÂ²S ì˜¤ë””ì˜¤ ì¶œë ¥ ì™„ì„±
   - [ ] ì›¹ ê¸°ë°˜ ê´€ë¦¬ ì¸í„°í˜ì´ìŠ¤ (Ethernet)
   - [ ] ë¡œê·¸ ë°ì´í„° SD Card ì €ì¥

### ì¥ê¸° ëª©í‘œ (6ê°œì›”)

1. **ì œí’ˆí™” ì¤€ë¹„**

   - [ ] PCB ì„¤ê³„ ë° ì œì‘
   - [ ] ì¼€ì´ìŠ¤ ë””ìì¸ (3D í”„ë¦°íŒ…)
   - [ ] ì¸ì¦ ê·œê²© ì¤€ìˆ˜ (CE, FCC)

2. **ì„±ëŠ¥ ìµœì í™”**
   - [ ] ì „ë ¥ ì†Œëª¨ 50% ê°ì†Œ
   - [ ] ì‘ë‹µ ì‹œê°„ 100ms ì´í•˜
   - [ ] FPGA ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ë¥  20% ì´í•˜

---

## ğŸ’­ ìµœì¢… ì†Œê°

### í”„ë¡œì íŠ¸ë¥¼ í†µí•´ ë°°ìš´ ê²ƒ

1. **"ì™„ë²½í•œ ì„¤ê³„"ë³´ë‹¤ "ê²€ì¦ ê°€ëŠ¥í•œ ì„¤ê³„"**

   - ë³µì¡í•œ ê¸°ëŠ¥ì„ í•œ ë²ˆì— êµ¬í˜„í•˜ë ¤ í•˜ì§€ ë§ ê²ƒ
   - ì‘ì€ ë‹¨ìœ„ë¡œ ìª¼ê°œì„œ ê°ê° ê²€ì¦ í›„ í†µí•©

2. **"ì‹œê°„ì€ í•­ìƒ ë¶€ì¡±í•˜ë‹¤"**

   - ë””ë²„ê¹… ì‹œê°„ì€ ì˜ˆìƒì˜ 3ë°°
   - ë²„í¼ë¥¼ ì¶©ë¶„íˆ í™•ë³´í•  ê²ƒ
   - Critical Pathë¥¼ ë¨¼ì € í•´ê²°

3. **"ì‹¤íŒ¨ë„ ìì‚°ì´ë‹¤"**
   - SPI í†µì‹  ì‹¤íŒ¨ë¥¼ í†µí•´ ë” ë§ì´ ë°°ì›€
   - ë¬¸ì œ í•´ê²° ê³¼ì •ì—ì„œ AXI í”„ë¡œí† ì½œ ê¹Šì´ ì´í•´
   - ë‹¤ìŒ í”„ë¡œì íŠ¸ì—ì„œ ê°™ì€ ì‹¤ìˆ˜ ë°©ì§€ ê°€ëŠ¥

### ë‹¤ìŒ í”„ë¡œì íŠ¸ì— ì ìš©í•  ì 

- âœ… **ì² ì €í•œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**ë¶€í„° ì‹œì‘
- âœ… **ë¬¸ì„œí™”**ë¥¼ ì½”ë”©ê³¼ ë™ì‹œì— ì§„í–‰
- âœ… **ì£¼ê°„ ë§ˆì¼ìŠ¤í†¤** ì„¤ì • ë° ì§„í–‰ë¥  ì²´í¬
- âœ… **ì½”ë“œ ë¦¬ë·°** ë¬¸í™” ì •ì°©
- âœ… **ë¦¬ìŠ¤í¬ ê´€ë¦¬** ì‚¬ì „ ìˆ˜í–‰

---

## ğŸ“ ì°¸ê³  ìë£Œ

### ê¸°ìˆ  ë¬¸ì„œ

- [AXI Protocol Specification v2.0](https://developer.arm.com/documentation/ihi0022/latest/)
- [SPI Protocol Guide](https://www.analog.com/en/analog-dialogue/articles/introduction-to-spi-interface.html)
- [MFRC522 Datasheet](https://www.nxp.com/docs/en/data-sheet/MFRC522.pdf)

### ë””ë²„ê¹… ë¡œê·¸

- [ëŒ€í™” íˆìŠ¤í† ë¦¬: SPI MISO Loopback Test](conversation://952951af-2bff-47a6-bb0e-46d6f63ddb7a)
- [ëŒ€í™” íˆìŠ¤í† ë¦¬: Debug SPI AXI Integration](conversation://56bc3e4d-5f62-472c-ba71-92b57b11d680)

### í”„ë¡œì íŠ¸ ì €ì¥ì†Œ

- GitHub: `/home/sogang/pjt/team2`
- ì£¼ìš” íŒŒì¼:
  - [`README.md`](file:///home/sogang/pjt/team2/README.md)
  - [`PORTFOLIO.md`](file:///home/sogang/pjt/team2/PORTFOLIO.md)
  - [SPI AXI RTL](file:///home/sogang/pjt/team2/codes/riscv_platform/riscv32im_soc/ips/spi_axi)
  - [SPI Test Firmware](file:///home/sogang/pjt/team2/codes/riscv_platform/riscv32im_soc/sw.riscv/spi_test)

---

**ì‘ì„±ì¼**: 2024.11.28  
**ì‘ì„±ì**: Team 2  
**í”„ë¡œì íŠ¸**: FPGA ê¸°ë°˜ ë„ì–´ë½ ì„¤ê³„
